// Awesomplete - Lea Verou - MIT license
(function(){function m(a,b){for(var e in a){var c=a[e],f=this.input.getAttribute("data-"+e.toLowerCase());this[e]="number"===typeof c?parseInt(f):!1===c?null!==f:c instanceof Function?null:f;this[e]||0===this[e]||(this[e]=e in b?b[e]:c)}}function c(a,b){return"string"===typeof a?(b||document).querySelector(a):a||null}function h(a,b){return k.call((b||document).querySelectorAll(a))}function l(){h("input.awesomplete").forEach(function(a){new d(a)})}var d=function(a,b){var e=this,g=b&&b.list&&0<b.list.length&&
Array.isArray(b.list[0]);this.input=c(a);this.input.setAttribute("autocomplete","off");this.input.setAttribute("aria-autocomplete","list");b=b||{};m.call(this,{minChars:2,maxItems:10,autoFirst:!1,filter:d.FILTER_CONTAINS,sort:d.SORT_BYLENGTH,item:g?d.RENDER_OBJ:d.RENDER_STRING,replace:g?d.REPLACE_OBJ:d.REPLACE_STRING},b);this.index=-1;this.container=c.create("div",{className:"awesomplete",around:a});this.ul=c.create("ul",{hidden:"hidden",inside:this.container});this.status=c.create("span",{className:"visually-hidden",
role:"status","aria-live":"assertive","aria-relevant":"additions",inside:this.container});g&&(this.hidden=c.create("input",{type:"hidden",name:a.name,value:a.value,before:a}),a.removeAttribute("name"));c.bind(this.input,{input:this.evaluate.bind(this),blur:this.close.bind(this),keydown:function(a){var b=a.keyCode;if(e.opened)if(13===b&&e.selected)a.preventDefault(),e.select();else if(27===b)e.close();else if(38===b||40===b)a.preventDefault(),e[38===b?"previous":"next"]()}});c.bind(this.input.form,
{submit:this.close.bind(this)});c.bind(this.ul,{mousedown:function(a){var b=a.target;if(b!==this){for(;b&&!/li/i.test(b.nodeName);)b=b.parentNode;b&&0===a.button&&e.select(b,a)}}});this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||b.list||[];d.all.push(this)};d.prototype={set list(a){Array.isArray(a)?this._list=a:"string"===typeof a&&-1<a.indexOf(",")?this._list=a.split(/\s*,\s*/):(a=c(a))&&
a.children&&(this._list=k.apply(a.children).map(function(a){return a.textContent.trim()}));document.activeElement===this.input&&this.evaluate()},get selected(){return-1<this.index},get opened(){return this.ul&&null==this.ul.getAttribute("hidden")},close:function(){this.ul.setAttribute("hidden","");this.index=-1;c.fire(this.input,"awesomplete-close")},open:function(){this.ul.removeAttribute("hidden");this.autoFirst&&-1===this.index&&this["goto"](0);c.fire(this.input,"awesomplete-open")},next:function(){this["goto"](this.index<
this.ul.children.length-1?this.index+1:-1)},previous:function(){var a=this.ul.children.length;this["goto"](this.selected?this.index-1:a-1)},"goto":function(a){var b=this.ul.children;this.selected&&b[this.index].setAttribute("aria-selected","false");this.index=a;-1<a&&0<b.length&&(b[a].setAttribute("aria-selected","true"),this.status.textContent=b[a].textContent);c.fire(this.input,"awesomplete-highlight")},select:function(a,b){if(a=a||this.ul.children[this.index]){var e;c.fire(this.input,"awesomplete-select",
{text:a.textContent,preventDefault:function(){e=!0},originalEvent:b});e||(this.replace(a),this.close(),c.fire(this.input,"awesomplete-selectcomplete"))}},evaluate:function(){var a=this,b=this.input.value;b.length>=this.minChars&&0<this._list.length?(this.index=-1,this.ul.innerHTML="",this._list.filter(function(e){return a.filter(e,b)}).sort(this.sort).every(function(e,c){a.ul.appendChild(a.item(e,b));return c<a.maxItems-1}),0===this.ul.children.length?this.close():this.open()):this.close()}};d.all=
[];d.FILTER_CONTAINS=function(a,b){return RegExp(c.regExpEscape(b.trim()),"i").test(a)};d.FILTER_STARTSWITH=function(a,b){return RegExp("^"+c.regExpEscape(b.trim()),"i").test(a)};d.SORT_BYLENGTH=function(a,b){return a.length!==b.length?a.length-b.length:a<b?-1:1};d.RENDER_STRING=function(a,b){return c.create("li",{innerHTML:a.replace(RegExp(c.regExpEscape(b.trim()),"gi"),"<mark>$&</mark>"),"aria-selected":"false"})};d.RENDER_OBJ=function(a,b){return c.create("li",{innerHTML:a[1].replace(RegExp(c.regExpEscape(b.trim()),
"gi"),"<mark>$&</mark>"),"aria-selected":"false","data-id":a[0]})};d.REPLACE_STRING=function(a){this.input.value=a.textContent};d.REPLACE_OBJ=function(a){this.input.value=a.textContent;this.hidden.value=a.getAttribute("data-id")};var k=Array.prototype.slice;c.create=function(a,b){var e=document.createElement(a),d;for(d in b){var f=b[d];"inside"===d?c(f).appendChild(e):"around"===d?(f=c(f),f.parentNode.insertBefore(e,f),e.appendChild(f)):"before"===d?(f=c(f),f.parentElement.insertBefore(e,f)):d in
e?e[d]=f:e.setAttribute(d,f)}return e};c.bind=function(a,b){if(a)for(var e in b){var c=b[e];e.split(/\s+/).forEach(function(b){a.addEventListener(b,c)})}};c.fire=function(a,b,c){var d=document.createEvent("HTMLEvents");d.initEvent(b,!0,!0);for(var f in c)d[f]=c[f];a.dispatchEvent(d)};c.regExpEscape=function(a){return a.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")};"undefined"!==typeof Document&&("loading"!==document.readyState?l():document.addEventListener("DOMContentLoaded",l));d.$=c;d.$$=h;"undefined"!==
typeof self&&(self.Awesomplete=d);"object"===typeof module&&module.exports&&(module.exports=d);return d})();