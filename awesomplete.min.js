// Awesomplete - Lea Verou - MIT license
(function(){function q(a,b){for(var c in a){var e=a[c],g=this.input.getAttribute("data-"+c.toLowerCase());this[c]="number"===typeof e?parseInt(g):!1===e?null!==g:e instanceof Function?null:g;this[c]||0===this[c]||(this[c]=c in b?b[c]:e)}}function d(a,b){return"string"===typeof a?(b||document).querySelector(a):a||null}function l(a,b){return n.call((b||document).querySelectorAll(a))}function m(){l("input.awesomplete").forEach(function(a){new f(a)})}var f=function(a,b){var c=this;this.input=d(a);this.input.setAttribute("autocomplete",
"off");this.input.setAttribute("aria-autocomplete","list");b=b||{};q.call(this,{minChars:2,maxItems:10,autoFirst:!1,filter:f.FILTER_CONTAINS,sort:f.SORT_BYLENGTH,item:function(a,b){return d.create("li",{innerHTML:a.replace(RegExp(d.regExpEscape(b.trim()),"gi"),"<mark>$&</mark>"),"aria-selected":"false"})},replace:function(a){this.input.value=a}},b);this.index=-1;this.container=d.create("div",{className:"awesomplete",around:a});this.ul=d.create("ul",{hidden:"",inside:this.container});this.status=d.create("span",
{className:"visually-hidden",role:"status","aria-live":"assertive","aria-relevant":"additions",inside:this.container});d.bind(this.input,{input:this.evaluate.bind(this),blur:this.close.bind(this),keydown:function(a){var b=a.keyCode;if(c.opened)if(13===b&&c.selected)a.preventDefault(),c.select();else if(27===b)c.close();else if(38===b||40===b)a.preventDefault(),c[38===b?"previous":"next"]()}});d.bind(this.input.form,{submit:this.close.bind(this)});d.bind(this.ul,{mousedown:function(a){a=a.target;if(a!==
this){for(;a&&!/li/i.test(a.nodeName);)a=a.parentNode;a&&c.select(a)}}});this.input.hasAttribute("list")?(this.list="#"+a.getAttribute("list"),a.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||b.list||[];f.all.push(this)};f.prototype={set list(a){Array.isArray(a)?this._list=a:"string"===typeof a&&-1<a.indexOf(",")?this._list=a.split(/\s*,\s*/):(a=d(a))&&a.children&&(this._list=n.apply(a.children).map(function(a){return a.textContent.trim()}));document.activeElement===this.input&&
this.evaluate()},get selected(){return-1<this.index},get opened(){return this.ul&&null==this.ul.getAttribute("hidden")},close:function(){this.ul.setAttribute("hidden","");this.index=-1;d.fire(this.input,"awesomplete-close")},open:function(){this.ul.removeAttribute("hidden");this.autoFirst&&-1===this.index&&this.goto(0);d.fire(this.input,"awesomplete-open")},next:function(){this.goto(this.index<this.ul.children.length-1?this.index+1:-1)},previous:function(){var a=this.ul.children.length;this.goto(this.selected?
this.index-1:a-1)},goto:function(a){var b=this.ul.children;this.selected&&b[this.index].setAttribute("aria-selected","false");this.index=a;-1<a&&0<b.length&&(b[a].setAttribute("aria-selected","true"),this.status.textContent=b[a].textContent);d.fire(this.input,"awesomplete-highlight")},select:function(a){if(a=a||this.ul.children[this.index]){var b;d.fire(this.input,"awesomplete-select",{text:a.textContent,preventDefault:function(){b=!0}});b||(this.replace(a.textContent),this.close(),d.fire(this.input,
"awesomplete-selectcomplete"))}},evaluate:function(){var a=this,b=this.input.value;if(b.length>=this.minChars&&0<this._list.length){this.index=-1;this.ul.innerHTML="";var c=this._list.filter(function(c){return a.filter(c,b)});d.mergeSort(c,this.sort);c.every(function(c,g){a.ul.appendChild(a.item(c,b));return g<a.maxItems-1});0===this.ul.children.length?this.close():this.open()}else this.close()}};f.all=[];f.FILTER_CONTAINS=function(a,b){return RegExp(d.regExpEscape(b.trim()),"i").test(a)};f.FILTER_STARTSWITH=
function(a,b){return RegExp("^"+d.regExpEscape(b.trim()),"i").test(a)};f.SORT_BYLENGTH=function(a,b){return a.length!==b.length?a.length-b.length:a<b?-1:1};var n=Array.prototype.slice;d.create=function(a,b){var c=document.createElement(a),e;for(e in b){var g=b[e];"inside"===e?d(g).appendChild(c):"around"===e?(g=d(g),g.parentNode.insertBefore(c,g),c.appendChild(g)):e in c?c[e]=g:c.setAttribute(e,g)}return c};d.bind=function(a,b){if(a)for(var c in b){var e=b[c];c.split(/\s+/).forEach(function(b){a.addEventListener(b,
e)})}};d.fire=function(a,b,c){var e=document.createEvent("HTMLEvents");e.initEvent(b,!0,!0);for(var d in c)e[d]=c[d];a.dispatchEvent(e)};d.regExpEscape=function(a){return a.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")};d.mergeSort=function(a,b){function c(a,d,f){var h=f-d;if(!(2>h))for(h=d+Math.floor(h/2),c(a,d,h),c(a,h,f);d<h;++d)if(0<b(a[d],a[h])){var l=a[d];a[d]=a[h];for(var r=a,k=h,n=f;k+1<n&&0>b(r[k+1],l);){var p=r,m=k+1,q=p[k];p[k]=p[m];p[m]=q;++k}r[k]=l}}c(a,0,a.length)};"undefined"!==typeof Document&&
("loading"!==document.readyState?m():document.addEventListener("DOMContentLoaded",m));f.$=d;f.$$=l;"undefined"!==typeof self&&(self.Awesomplete=f);"object"===typeof exports&&(module.exports=f);return f})();
